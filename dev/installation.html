

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; PAVICS 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PAVICS 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Developer Documentation" href="index.html"/>
        <link rel="next" title="Load balancing" href="load_balancing.html"/>
        <link rel="prev" title="Developer Documentation" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PAVICS
          

          
            
            <img src="../_static/pavics_v.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-methods">Installation methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pavics-and-dockerhub-images">PAVICS and Dockerhub images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pavics-installation-with-docker-compose">PAVICS installation with <code class="docutils literal"><span class="pre">docker-compose</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-containers-to-the-latest-version">Updating containers to the latest version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-bird-services">Resetting Bird services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restarting-bird-services">Restarting Bird services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-specification">Port specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="load_balancing.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Birdhouse service configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="vm.html">VM configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="permissions.html">User and Group management</a></li>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html">GeoServer administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_management.html">Data and service management</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration_tests.html">Integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="builddocs.html">Building the docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/index.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/index.html">Using workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../provenance/index.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo.html">TODO</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PAVICS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Documentation</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PAVICS is built to work within POSIX and POSIX-like systems (e.g. Unix/Linux). For Windows users who want to administer a PAVICS data server, you may need to either install <a class="reference external" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a>, a Unux/Linux virtual machine or use a POSIX API environment like the <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/about">Windows Subsytem for Linux</a> or <a class="reference external" href="https://cygwin.com/">Cygwin</a> to interface with the PAVICS server system.</p>
</div>
<div class="section" id="installation-methods">
<h2>Installation methods<a class="headerlink" href="#installation-methods" title="Permalink to this headline">¶</a></h2>
<p>PAVICS can be installed from source on <a class="reference external" href="https://www.github.com/Ouranosinc/pavics-sdi/">GitHub</a> or by using <a class="reference external" href="https://www.docker.com/what-docker">Docker</a>. Docker is a virtualization tool for running isolated service images built with specific library environments.</p>
<p>Begin by following the guide for installing <code class="docutils literal"><span class="pre">Docker</span> <span class="pre">Community</span> <span class="pre">Edition</span></code> on your home machine from the <a class="reference external" href="https://docs.docker.com/install/">Docker Installation Page</a>. Docker Community Edition is a set of command line tools for creating and launching container-based applications.</p>
<p>Depending on your Linux distribution, you may need to either add a new ppa/apt/yum/dnf repository to your system or you can download and launch the installer directly.</p>
<p>For users not using Linux, refer to the following guides for <a class="reference external" href="https://docs.docker.com/docker-for-mac/">Mac OS</a> and for <a class="reference external" href="https://docs.docker.com/docker-for-windows/">Windows</a>.</p>
</div>
<div class="section" id="pavics-and-dockerhub-images">
<h2>PAVICS and Dockerhub images<a class="headerlink" href="#pavics-and-dockerhub-images" title="Permalink to this headline">¶</a></h2>
<p>All code produced for the PAVICS project is Open Source and hosted publicly through GitHub repositories. Among our members/users, the preferred methodology for packaging and deployment relies on Docker images As such, we employ the automatic Docker Image building feature of <a class="reference external" href="https://hub.docker.com/">DockerHub</a>. This feature automatically builds a new image for every push to the GitHub repository for all given branches, for all repositories that include a <code class="docutils literal"><span class="pre">Dockerfile</span></code>. The <a class="reference external" href="https://hub.docker.com/u/pavics/">resulting images</a> are all publicly available for container execution and distribution. Any docker image can be obtained using the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">pavics</span><span class="o">/</span><span class="n">pavics</span><span class="o">-</span><span class="n">datacatalog</span>
</pre></div>
</div>
<p>Most of the code base for PAVICS is forked from the <a class="reference external" href="https://birdhouse.readthedocs.io/en/latest/index.html">Birdhouse Project</a> which already has multiple DockerHub <a class="reference external" href="https://hub.docker.com/u/birdhouse">build processes</a>. Using our own DockerHub build gives us the advantage of having our own upstream build process for the code being modified by CRIM / Ouranos. Many of the modifications to these birdhouse components are merged upstream, but some are specific to the PAVICS project and we felt it was worthwhile to maintain an independent build process.</p>
</div>
<div class="section" id="pavics-installation-with-docker-compose">
<h2>PAVICS installation with <code class="docutils literal"><span class="pre">docker-compose</span></code><a class="headerlink" href="#pavics-installation-with-docker-compose" title="Permalink to this headline">¶</a></h2>
<p>First mount or create a symlink for the datasets storage at <code class="docutils literal"><span class="pre">/data</span></code>.
Mount or make a symlink for the geoserver data storage so that <code class="docutils literal"><span class="pre">/geoserver_data</span></code> could be used (read/write) by geoserver.</p>
<p>To install the suite of docker images you must use <a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a>. Docker-compose is a docker helper for coordinating multiple docker images at once. Run the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span>
</pre></div>
</div>
<p>Then get the <em>build recipe</em> from <a class="reference external" href="https://github.com/Ouranosinc/pavics-sdi.git">pavics-sdi</a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Ouranosinc</span><span class="o">/</span><span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">/</span><span class="n">birdhouse</span> <span class="c1">### TO BE REVISED</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Base PAVICS installation is incomplete. The following lines refer to Phoenix instance. Need to specify which birds are needed for a bare installation of PAVICS: Phoenix, FlyingPigeon, Malleefowl, Emu, etc.</p>
</div>
<p>In the file <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code>, within the <cite>phoenix/volumes</cite> configuration, set the environment variable SSL_CERTIFICATE  to a valid certificate. This certificate file should contain both the CERTIFICATE and PRIVATE KEY parts as required by the nginx “ssl_certificate_key” and “ssl_certificate” parameters.</p>
<p>Then simply run the following command, taking care to select an appropriate host name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;boreas.ouranos.ca&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d&#39;</span>
</pre></div>
</div>
<p>This installation will run on a single server instance, but there are instructions for <a class="reference internal" href="load_balancing.html#load-balancing"><span class="std std-ref">Load balancing</span></a>.</p>
</div>
<div class="section" id="updating-containers-to-the-latest-version">
<h2>Updating containers to the latest version<a class="headerlink" href="#updating-containers-to-the-latest-version" title="Permalink to this headline">¶</a></h2>
<p>To synchronize a deployment with the latest container available on dockerhub:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Set working directory where the docker-compose.yml is located. Usually :</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">/</span><span class="n">birdhouse</span> <span class="c1">### TO BE REVISED</span>

<span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Pull the latest containers (container_name is optional but can limit the operation to only one container rather than applying to all containers)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose pull [container_name]&#39;</span>

<span class="c1"># Stopping containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose stop [container_name]&#39;</span>

<span class="c1"># Start again containers (-d is for detached, avoid it to get all output to the command line)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d [container_name]&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">container_name</span></code> is the name chosen in the docker-compose.yml, not the name of the docker image.</p>
</div>
</div>
<div class="section" id="resetting-bird-services">
<h2>Resetting Bird services<a class="headerlink" href="#resetting-bird-services" title="Permalink to this headline">¶</a></h2>
<p>If a Bird Service becomes unusable, the docker containers can easily be reset to default settings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Stopping and removing containers (this will flush their states)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose down&#39;</span>

<span class="c1"># Start again containers (-d is for detached, avoid it to get all output to the command line)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some manual tasks are required after resetting the birdhouse environment : See the manual steps under the Phoenix configuration</p>
</div>
</div>
<div class="section" id="restarting-bird-services">
<h2>Restarting Bird services<a class="headerlink" href="#restarting-bird-services" title="Permalink to this headline">¶</a></h2>
<p>If the dockers containers need to be stopped (including the docker service, if required) these steps will preserve the docker state and all configurations set via Bird Service web portals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Docker management requires sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Stopping running containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose stop&#39;</span>

<span class="c1"># Stopping the docker service</span>
<span class="n">service</span> <span class="n">docker</span> <span class="n">stop</span>
</pre></div>
</div>
<p>Restarting Bird Services (required after restarting the host vm):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Starting the docker service</span>
<span class="n">service</span> <span class="n">docker</span> <span class="n">start</span>

<span class="c1"># Starting the birdhouse containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose start&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="port-specification">
<h2>Port specification<a class="headerlink" href="#port-specification" title="Permalink to this headline">¶</a></h2>
<p>The <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code> config file exposes ports for each docker container (left part is the public one, right part the container internal one). We try to respect the following convention:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">8</span><span class="n">xxx</span> <span class="p">:</span> <span class="n">port</span> <span class="n">usually</span> <span class="n">responding</span> <span class="k">for</span> <span class="n">the</span> <span class="n">service</span> <span class="p">(</span><span class="n">The</span> <span class="n">HTTP</span> <span class="n">port</span><span class="p">)</span>
<span class="mi">28</span><span class="n">xxx</span><span class="p">:</span> <span class="n">https</span> <span class="n">port</span>
<span class="mi">38</span><span class="n">xxx</span><span class="p">:</span> <span class="n">the</span> <span class="n">output</span> <span class="n">port</span> <span class="p">(</span><span class="n">To</span> <span class="n">be</span> <span class="n">documented</span><span class="p">)</span>
<span class="mi">48</span><span class="n">xxx</span><span class="p">:</span> <span class="n">the</span> <span class="n">supervisor</span> <span class="n">port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">container</span>
</pre></div>
</div>
<p>Container xxx value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Phoenix</span> <span class="p">:</span> <span class="mi">443</span> <span class="p">(</span><span class="n">With</span> <span class="mi">8081</span> <span class="k">as</span> <span class="n">http</span> <span class="ow">and</span> <span class="mi">8443</span> <span class="k">as</span> <span class="n">https</span><span class="p">)</span>
<span class="n">Malleefowl</span> <span class="p">:</span> <span class="mi">091</span>
<span class="n">Flyingpigeon</span> <span class="p">:</span> <span class="mi">093</span>
<span class="n">Emu</span> <span class="p">:</span> <span class="mi">094</span>
<span class="n">Solr</span> <span class="p">:</span> <span class="mi">983</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">ncWMS2</span> <span class="p">:</span> <span class="mi">080</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">thredds</span> <span class="p">:</span> <span class="mi">083</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">pavics</span><span class="o">-</span><span class="n">catalog</span> <span class="p">:</span> <span class="mi">086</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">geoserver</span> <span class="p">:</span> <span class="mi">087</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
</pre></div>
</div>
<p>The exception is the Pavics-frontend, which has port 3000.</p>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Update the installation and config with security changes</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="load_balancing.html" class="btn btn-neutral float-right" title="Load balancing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Developer Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Ouranos &amp; CRIM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>