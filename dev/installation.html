

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation and Configuration &mdash; PAVICS 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PAVICS 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Developer Documentation" href="index.html"/>
        <link rel="next" title="Load balancing" href="load_balancing.html"/>
        <link rel="prev" title="Developer Documentation" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PAVICS
          

          
            
            <img src="../_static/pavics_v.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation and Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-using-docker-compose">Installation using <code class="docutils literal"><span class="pre">docker-compose</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-container-to-the-latest-version">Updating container to the latest version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-the-birdhouse-dockers">Resetting the birdhouse dockers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restarting-the-birdhouse-dockers">Restarting the birdhouse dockers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ports">Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#individual-components-configuration">Individual Components Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phoenix">Phoenix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ncwms">ncWMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thredds">Thredds</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hummingbird">Hummingbird</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pavics-datacatalog">PAVICS-DataCatalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#magpie">Magpie</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="load_balancing.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="vm.html">VM configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="builddocs.html">Building the docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="permissions.html">User management</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_management.html">Data management</a></li>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html">Geoserver administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration_tests.html">Integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/index.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows/index.html">Using workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/index.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../provenance/index.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo.html">TODO</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PAVICS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Documentation</a> &raquo;</li>
        
      <li>Installation and Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation-and-configuration">
<h1>Installation and Configuration<a class="headerlink" href="#installation-and-configuration" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Update the installation and config with security changes</p>
</div>
<p>Since all of the code produced for the PAVICS project is hosted on public GitHub repositories, and that the preferred methodology for packaging and deployment uses Docker images, we set out to use the automatic Docker Image building feature of <a class="reference external" href="https://hub.docker.com/">DockerHub</a>. This feature automatically builds a new image for every push to the GitHub repository for all given branches, given that these repositories have a Dockerfile. The <a class="reference external" href="https://hub.docker.com/u/pavics/">resulting images</a> are all publicly available for container execution and sharing of our work. Any docker image can be obtained using the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">pavics</span><span class="o">/</span><span class="n">pavics</span><span class="o">-</span><span class="n">datacatalog</span>
</pre></div>
</div>
<p>Most of the code base has been forked from the Birdhouse project which already has multiple DockerHub <a class="reference external" href="https://hub.docker.com/u/birdhouse">build processes</a>. Using our own DockerHub builds gives us the advantage of having our own upstream build process for the code being modified by CRIM / Ouranos. Many of the modifications to these birdhouse components are merged upstream, but some are specific to the PAVICS project and we felt it was worthwhile to have this independent build process.</p>
<div class="section" id="installation-using-docker-compose">
<h2>Installation using <code class="docutils literal"><span class="pre">docker-compose</span></code><a class="headerlink" href="#installation-using-docker-compose" title="Permalink to this headline">¶</a></h2>
<p>Let’s assume that you have a LinuxOS with <a class="reference external" href="http://docker.com">Docker</a> (&gt;1.10) installed.
First mount or create a symlink for the datasets storage at <code class="docutils literal"><span class="pre">/data</span></code>.
Mount or make a symlink for the geoserver data storage so that <code class="docutils literal"><span class="pre">/geoserver_data</span></code> could be used (read/write) by geoserver.
To install the suite of docker images, we use <a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a>, so you’ll need to install it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span>
</pre></div>
</div>
<p>Then get the <em>build recipe</em> from <a class="reference external" href="https://github.com/Ouranosinc/pavics-sdi.git">pavics-sdi</a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Ouranosinc</span><span class="o">/</span><span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">/</span><span class="n">birdhouse</span>
</pre></div>
</div>
<p>In the file <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code>, within the <code class="docutils literal"><span class="pre">phoenix/volumes</span></code> configuration, set the environment variable SSL_CERTIFICATE  to a valid certificate. The certificate file should contain both the CERTIFICATE and PRIVATE KEY parts as required by the nginx “ssl_certificate_key” and “ssl_certificate” parameters.</p>
<p>Then simply run the following command, taking care to select an appropriate host name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;boreas.ouranos.ca&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d&#39;</span>
</pre></div>
</div>
<p>This installation will run on a single server instance, but there are instructions for <a class="reference internal" href="load_balancing.html#load-balancing"><span class="std std-ref">Load balancing</span></a>.</p>
</div>
<div class="section" id="updating-container-to-the-latest-version">
<h2>Updating container to the latest version<a class="headerlink" href="#updating-container-to-the-latest-version" title="Permalink to this headline">¶</a></h2>
<p>To synchronize a deployment with the latest version of container available on dockerhub:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Set working directory where the docker-compose.yml is located. Usually :</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">pavics</span><span class="o">-</span><span class="n">sdi</span><span class="o">/</span><span class="n">birdhouse</span>

<span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Pull the latest containers (container_name is optional but can limit the operation to only one container rather than applying to all containers)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose pull [container_name]&#39;</span>

<span class="c1"># Stopping containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose stop [container_name]&#39;</span>

<span class="c1"># Start again containers (-d is for detached, avoid it to get all output to the command line)</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d [container_name]&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">container_name</span></code> is the name chosen in the docker-compose.yml, not the name of the docker image.</p>
</div>
</div>
<div class="section" id="resetting-the-birdhouse-dockers">
<h2>Resetting the birdhouse dockers<a class="headerlink" href="#resetting-the-birdhouse-dockers" title="Permalink to this headline">¶</a></h2>
<p>If the VM became unusable the docker containers can easily be reset to default:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="c1"># Docker required sudo access</span>
 <span class="n">sudo</span> <span class="n">su</span>

 <span class="c1"># Stopping and removing containers (this will flush their states)</span>
 <span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose down&#39;</span>

 <span class="c1"># Start again containers (-d is for detached, avoid it to get all output to the command line)</span>
 <span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose up -d&#39;</span>

<span class="n">Some</span> <span class="n">manual</span> <span class="n">tasks</span> <span class="n">are</span> <span class="n">required</span> <span class="n">after</span> <span class="n">resetting</span> <span class="n">the</span> <span class="n">birdhouse</span> <span class="n">environment</span> <span class="p">:</span> <span class="n">See</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">steps</span> <span class="n">under</span> <span class="n">the</span> <span class="n">Phoenix</span> <span class="n">configuration</span>
</pre></div>
</div>
</div>
<div class="section" id="restarting-the-birdhouse-dockers">
<h2>Restarting the birdhouse dockers<a class="headerlink" href="#restarting-the-birdhouse-dockers" title="Permalink to this headline">¶</a></h2>
<p>If the dockers containers need to be stopped (including the docker service if required). These steps will preserve the docker state and thus all configurations done using the web sites:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Stopping running containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose stop&#39;</span>

<span class="c1"># Stopping the docker service</span>
<span class="n">service</span> <span class="n">docker</span> <span class="n">stop</span>
</pre></div>
</div>
<p>And starting dockers (required after restarting the host vm):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Docker required sudo access</span>
<span class="n">sudo</span> <span class="n">su</span>

<span class="c1"># Starting the docker service</span>
<span class="n">service</span> <span class="n">docker</span> <span class="n">start</span>

<span class="c1"># Starting the birdhouse containers</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s1">&#39;&lt;public-ip&gt;&#39;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;docker-compose start&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="ports">
<h2>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h2>
<p>The <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code> config file exposes ports for each docker container (left part is the public one, right part the container internal one). We try to respect the following convention:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">8</span><span class="n">xxx</span> <span class="p">:</span> <span class="n">port</span> <span class="n">usually</span> <span class="n">responding</span> <span class="k">for</span> <span class="n">the</span> <span class="n">service</span> <span class="p">(</span><span class="n">The</span> <span class="n">HTTP</span> <span class="n">port</span><span class="p">)</span>
<span class="mi">28</span><span class="n">xxx</span><span class="p">:</span> <span class="n">https</span> <span class="n">port</span>
<span class="mi">38</span><span class="n">xxx</span><span class="p">:</span> <span class="n">the</span> <span class="n">output</span> <span class="n">port</span> <span class="p">(</span><span class="n">To</span> <span class="n">be</span> <span class="n">documented</span><span class="p">)</span>
<span class="mi">48</span><span class="n">xxx</span><span class="p">:</span> <span class="n">the</span> <span class="n">supervisor</span> <span class="n">port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">container</span>
</pre></div>
</div>
<p>Container xxx value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Phoenix</span> <span class="p">:</span> <span class="mi">443</span> <span class="p">(</span><span class="n">With</span> <span class="mi">8081</span> <span class="k">as</span> <span class="n">http</span> <span class="ow">and</span> <span class="mi">8443</span> <span class="k">as</span> <span class="n">https</span><span class="p">)</span>
<span class="n">Malleefowl</span> <span class="p">:</span> <span class="mi">091</span>
<span class="n">Flyingpigeon</span> <span class="p">:</span> <span class="mi">093</span>
<span class="n">Emu</span> <span class="p">:</span> <span class="mi">094</span>
<span class="n">Solr</span> <span class="p">:</span> <span class="mi">983</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">ncWMS2</span> <span class="p">:</span> <span class="mi">080</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">thredds</span> <span class="p">:</span> <span class="mi">083</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">pavics</span><span class="o">-</span><span class="n">catalog</span> <span class="p">:</span> <span class="mi">086</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
<span class="n">geoserver</span> <span class="p">:</span> <span class="mi">087</span> <span class="p">(</span><span class="n">No</span> <span class="n">https</span> <span class="ow">or</span> <span class="n">output</span> <span class="n">ports</span><span class="p">)</span>
</pre></div>
</div>
<p>The exception is the Pavics-frontend, which has port 3000.</p>
</div>
<div class="section" id="individual-components-configuration">
<h2>Individual Components Configuration<a class="headerlink" href="#individual-components-configuration" title="Permalink to this headline">¶</a></h2>
<p>All birdhouse components are deployed and configured using the same technique, which consists in:</p>
<ul class="simple">
<li>Run <code class="docutils literal"><span class="pre">docker-compose</span></code> on a <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code> config file to launch a group of containers using their images and some options.</li>
<li>When a container is starting a make call with the target update-config and start is done (specified by the dockerfile CMD statement)<ul>
<li>The update-config target update the container application config using buildout and the custom.cfg config file</li>
<li>The start target launch the application using supervisor</li>
</ul>
</li>
<li>To customize the container application config we must update the custom.cfg file used by the buildout recipe of each container.</li>
</ul>
<p>Since custom.cfg is built into the docker image and thus reset each time we run an image the only way to alter it is to mount a host file inside the container using the volume option. Therefore a <code class="file docutils literal"><span class="pre">custom.cfg</span></code> is configured on host for each birdhouse component and mounted inside the container using the volume option of the <code class="file docutils literal"><span class="pre">docker-compose.yml</span></code> file. This way each time a container is started, it is configured by the host <code class="file docutils literal"><span class="pre">custom.cfg</span></code> file which indeed persist the lifecycle of a container
The <code class="file docutils literal"><span class="pre">custom.cfg</span></code> is a buildout configuration file which extends <code class="file docutils literal"><span class="pre">buildout.cfg</span></code> providing default parameters. Each birdhouse component has it’s own buildout recipe looking for particular parameters to configure their application. An exemple of recipe for ncWMS can be found here:  <a class="reference external" href="https://github.com/bird-house/birdhousebuilder.recipe.ncwms">https://github.com/bird-house/birdhousebuilder.recipe.ncwms</a>. Look on github for other components recipe : <a class="reference external" href="https://github.com/bird-house">https://github.com/bird-house</a>.</p>
<div class="section" id="phoenix">
<h3>Phoenix<a class="headerlink" href="#phoenix" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="file docutils literal"><span class="pre">/config/phoenix/custom.cfg</span></code></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>settings<span class="o">]</span>
<span class="c1"># User: admin, Password: querty</span>
phoenix-password <span class="o">=</span> sha256:...
</pre></div>
</div>
</div>
<p>To change password get into the phoenix running container and use <code class="docutils literal"><span class="pre">make</span> <span class="pre">passwd</span></code>. This will update the persistant host <code class="file docutils literal"><span class="pre">custom.cfg</span></code> with the new password hash.
If an error about missing <code class="docutils literal"><span class="pre">IPython.lib</span></code> occurs install <a class="reference external" href="https://ipython.org">ipython</a> like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>source $ANACONDA_HOME/bin/activate birdhouse
pip install ipython
</pre></div>
</div>
<p>Phoenix still need manual configuration so SOLR indexes correctly the TREDDS catalog. Here are the steps:</p>
<ol class="arabic">
<li><p class="first">Go to <a class="reference external" href="https:/">https:/</a>/&lt;platform_url&gt;:8443/</p>
</li>
<li><p class="first">Click on the login button <img alt="login" src="../_images/phoenix_login.png" /></p>
</li>
<li><p class="first">Use the admin phoenix access with ‘querty’ password:</p>
<img alt="../_images/phoenix_username.png" src="../_images/phoenix_username.png" />
</li>
<li><p class="first">Go to the settings page <img alt="settings" src="../_images/phoenix_setting.png" /></p>
</li>
<li><p class="first">Click on the service button:</p>
<img alt="../_images/phoenix_services.png" src="../_images/phoenix_services.png" />
</li>
<li><p class="first">Register a new service:</p>
<img alt="../_images/phoenix_register.png" src="../_images/phoenix_register.png" />
</li>
<li><p class="first">Fill the form using the thredds catalog url (use the OpenStack internal IP), a service name of your choice and be sure to check the Thredds Catalog service type :</p>
<img alt="../_images/phoenix_register_thredds.png" src="../_images/phoenix_register_thredds.png" />
</li>
<li><p class="first">Click on the register button</p>
</li>
<li><p class="first">Go to the Solr settings page by repeating the steps 4 and 5 but this time using the Solr button.</p>
<img alt="../_images/phoenix_solr.png" src="../_images/phoenix_solr.png" />
</li>
<li><p class="first">Use the Parameters tab and increase the crawling depth to match the deepest catalog depth :</p>
</li>
<li><p class="first">Activate the crawling in the Thredds Services tab by clicking on the toggle button near the + symbol.</p>
<img alt="../_images/phoenix_thredds_activate.png" src="../_images/phoenix_thredds_activate.png" />
</li>
<li><p class="first">The status should turn to green when you click on the refresh button.</p>
</li>
</ol>
<p>You’re done !</p>
</div>
<div class="section" id="ncwms">
<h3>ncWMS<a class="headerlink" href="#ncwms" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="file docutils literal"><span class="pre">/config/ncwms2/custom.mfg</span></code></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>settings<span class="o">]</span>
tomcat-ncwms-password <span class="o">=</span> &lt;enter ncwms password&gt;

<span class="o">[</span>ncwms<span class="o">]</span>
<span class="nv">data_dir</span> <span class="o">=</span> /pavics-data
</pre></div>
</div>
</div>
<div class="section" id="manual-setup-of-the-running-docker">
<h4>Manual setup of the running docker<a class="headerlink" href="#manual-setup-of-the-running-docker" title="Permalink to this headline">¶</a></h4>
<p>To access the ncWMS admin page (changes be overriden each time the container is restarted), edit the file: <code class="file docutils literal"><span class="pre">/opt/conda/envs/birdhouse/opt/apache-tomcat/conf/tomcat-users.xml</span></code> and remove the comment block around the manager-gui and ncWMS-admin role.
The administration page allow administrators to add new datasets but again it will not persist upon container restarting.</p>
<p>Default Tomact credentials:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;birdhouse&quot;</span>
<span class="n">password</span><span class="o">=</span><span class="s2">&quot;4FO72WcTt7K9gYiNKApf&quot;</span>
</pre></div>
</div>
<p>Default ncWMS credentials:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span>
<span class="n">password</span><span class="o">=</span><span class="s2">&quot;ju68hfld&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-services">
<h4>Dynamic services<a class="headerlink" href="#dynamic-services" title="Permalink to this headline">¶</a></h4>
<p>The dynamic services section allow with only one command to enable access to all the database available at <code class="file docutils literal"><span class="pre">M:data16projetsmultiPAVICSdata</span></code> by configuring a file system entrypoint. The only thing to do is to use the following url: <a class="reference external" href="http:/">http:/</a>/&lt;domain&gt;:8080/ncWMS2/wms?SERVICE=WMS&amp;REQUEST=GetCapabilities&amp;VERSION=1.3.0&amp;DATASET=outputs/&lt;path&gt;
and replace <code class="docutils literal"><span class="pre">&lt;path&gt;</span></code> by the relative path to <code class="file docutils literal"><span class="pre">M:data16projetsmultiPAVICSdata</span></code> to the required dataset. So thanks to this config and to the catalog service we should be able to get the entire database list from the catalog and access their WMS by using the relative path in the wms url.</p>
</div>
</div>
<div class="section" id="thredds">
<h3>Thredds<a class="headerlink" href="#thredds" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>thredds<span class="o">]</span>
<span class="nv">data_root</span> <span class="o">=</span> /pavics-data
<span class="nv">allow_wcs</span> <span class="o">=</span> <span class="nb">true</span>
<span class="nv">allow_wms</span> <span class="o">=</span> <span class="nb">true</span>
</pre></div>
</div>
</div>
<div class="section" id="hummingbird">
<h3>Hummingbird<a class="headerlink" href="#hummingbird" title="Permalink to this headline">¶</a></h3>
<p>First try at running CDO operation using the Hummingbird WPS (with url for input NetCDF file, only seems to work with the fileserver, not OPeNDAP), e.g. :
<a class="reference external" href="http://132.217.140.31:8092/wps?service=WPS&amp;version=1.0.0&amp;request=Execute&amp;identifier=cdo_operation&amp;DataInputs=dataset=http://192.168.101.175:8083/thredds/fileServer/birdhouse/nrcan/nrcan_canada_daily/nrcan_canada_daily_pr_1960.nc;operator=monmax">http://132.217.140.31:8092/wps?service=WPS&amp;version=1.0.0&amp;request=Execute&amp;identifier=cdo_operation&amp;DataInputs=dataset=http://192.168.101.175:8083/thredds/fileServer/birdhouse/nrcan/nrcan_canada_daily/nrcan_canada_daily_pr_1960.nc;operator=monmax</a>
returns “PyWPS Process cdo_operation successfully calculated”. However the output points to a NetCDF file on localhost (<a class="reference external" href="http://localhost:38092/wpsoutputs/hummingbird/output-4f80cb02-58db-11e6-8a37-533b457038a6.nc">http://localhost:38092/wpsoutputs/hummingbird/output-4f80cb02-58db-11e6-8a37-533b457038a6.nc</a>).
Need to substitute localhost for the ip (132.217.140.31) and keep the same port : <a class="reference external" href="http://132.217.140.31:38092/wpsoutputs/hummingbird/output-4f80cb02-58db-11e6-8a37-533b457038a6.nc">http://132.217.140.31:38092/wpsoutputs/hummingbird/output-4f80cb02-58db-11e6-8a37-533b457038a6.nc</a>
Previous note: the same operation with the command-line, and using the OPeNDAP link (i.e. &gt;&gt; cdo monmax <a class="reference external" href="http://132.217.140.31:8083/thredds/dodsC/birdhouse/nrcan/nrcan_canada_daily/nrcan_canada_daily_pr_1960.nc">http://132.217.140.31:8083/thredds/dodsC/birdhouse/nrcan/nrcan_canada_daily/nrcan_canada_daily_pr_1960.nc</a> output.nc) succeeds, in ~3 minutes. It is much faster if the file is local. This brings up the question of whether we should pass the catalogue url when we know the file is actually on a local machine…
Trying to execute the same process via our Phoenix installation is not possible. The execute button remains greyed out after entering an url and selecting an operator.</p>
</div>
<div class="section" id="pavics-datacatalog">
<h3>PAVICS-DataCatalog<a class="headerlink" href="#pavics-datacatalog" title="Permalink to this headline">¶</a></h3>
<p>In the catalog.cfg file:
Provide the solr and thredds host.
Set the wps host to the server that will be exposing the catalog (this is the server where wps temporary output files will be saved).
Set the WMS alternate server if desired.</p>
</div>
<div class="section" id="magpie">
<h3>Magpie<a class="headerlink" href="#magpie" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Complete</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="load_balancing.html" class="btn btn-neutral float-right" title="Load balancing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Developer Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Ouranos &amp; CRIM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>